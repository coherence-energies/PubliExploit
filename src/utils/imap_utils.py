# imap_utils.py
import imaplib
import sys

def connect_to_imap(config, config_sites):
    """
    Se connecter au serveur IMAP.

    :param config (ConfigParser): Configuration IMAP.
    :param config_sites (ConfigParser): Configuration des sites.
    :return (imaplib.IMAP4_SSL): Connexion IMAP.
    """
    try:
        # Récupérer les informations de configuration IMAP
        imap_server = config.get('IMAP', 'server')
        username = config_sites.get('username')
        password = config_sites.get('password')
        
        # Se connecter au serveur IMAP
        mail = imaplib.IMAP4_SSL(imap_server)
        mail.login(username, password)
        
        # Renvoyer l'objet de connexion IMAP
        return mail
    except Exception as e:
        # En cas d'erreur, afficher l'erreur et quitter le programme
        print(f"Erreur lors de la connexion au serveur IMAP : {e}")
        sys.exit(1)

def disconnect_from_imap(mail):
    """
    Se déconnecter du serveur IMAP.

    :param mail (imaplib.IMAP4_SSL): Connexion IMAP à fermer.
    """
    if mail:
        try:
            # Déconnecter la connexion IMAP
            mail.logout()
            print("Déconnexion du serveur IMAP.")
        except Exception as e:
            # Afficher un message d'erreur en cas d'échec de la déconnexion
            print("Erreur lors de la déconnexion du serveur IMAP")